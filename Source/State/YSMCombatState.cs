using System.Text;

namespace _15TextRPG.Source.State
{
    internal class YSMCombatState : IGameState
    {
        public void DisplayMenu(GameManager gameManager)
        {
            Console.OutputEncoding = Encoding.UTF8;
            Console.Title = "Hacking in Progress...";
            Console.ForegroundColor = ConsoleColor.Green;
            Console.BackgroundColor = ConsoleColor.Black;
            Console.Clear();

            int totalTime = 1000; // 해킹 제한 시간 (초)
            int barLength = 3000; // 진행 바 길이


            int cursorTop, cursorLeft;

            Console.WriteLine("Hacking in progress...");
            Console.WriteLine("Time Remaining:");

            Console.SetCursorPosition(0, 2);
            Console.WriteLine("ss");
            Console.WriteLine($" {30} sec remaining");
            Console.WriteLine("==========================================");
            Console.Write(">> ");

            string answer = "";

            for (int timeLeft = totalTime; timeLeft >= 0; timeLeft--)
            {
                cursorTop = Console.CursorTop;
                cursorLeft = Console.CursorLeft;
                Console.ForegroundColor = ConsoleColor.Green;
                Console.SetCursorPosition(0, 0);
                Console.WriteLine("Hacking in progress...                                ");
                Console.SetCursorPosition(0, 1);
                Console.WriteLine("Time Remaining:                                       ");
                int filled = (int)((timeLeft / (float)totalTime) * barLength);
                string progressBar = "[" + new string('█', filled/100) + new string(' ', (barLength - filled)/100) + "                   ";

                Console.SetCursorPosition(0, 2);
                Console.WriteLine(progressBar);
                Console.WriteLine($" {timeLeft}                                                    ");
                Console.WriteLine("==========================================");
                Console.SetCursorPosition(cursorLeft, cursorTop);

                ConsoleKeyInfo key;
                if (Console.KeyAvailable)
                {                   
                    key = Console.ReadKey();
                    if(key.Key == ConsoleKey.Enter)
                    {
                        if(answer == "ITEM ICE_NO_33")
                        {
                            string msg = "아이스 브레이커를 사용하셨습니다.";
                            foreach(char c in msg)
                            {
                                Console.Write(c);
                                Thread.Sleep(50);
                            }
                        }
                        if(answer == "search")
                        {
                            Console.WriteLine("[SYSTEM_WARE][01EEA32] 방화벽 등급 12");
                            Console.WriteLine("[COMPUTER][유승민] 방화벽 등급 2");
                        }
                        if (answer == "HACK 01EEA32")
                        {
                            Console.BackgroundColor = ConsoleColor.Red;
                            Console.ForegroundColor = ConsoleColor.White;
                            string msg = "고등급 방화벽에 침투합니다. 20.08ms가 지나면 감지됩니다.";
                            foreach (char c in msg)
                            {
                                Console.Write(c);
                                Thread.Sleep(50);
                            }
                            Console.BackgroundColor = ConsoleColor.Black;
                            Console.ForegroundColor = ConsoleColor.Green;
                        }

                        Console.WriteLine();
                        answer = "";
                        Console.Write(">> ");
                        Console.Beep();
                    }
                    else if(key.Key == ConsoleKey.Backspace)
                    {
                        if(answer.Length > 0)
                        {
                            answer = answer.Substring(0, answer.Length - 1);

                            Console.SetCursorPosition(Console.CursorLeft, Console.CursorTop);
                            Console.Write(" ");
                            Console.SetCursorPosition(Console.CursorLeft - 1, Console.CursorTop);
                        }
                    }
                    else
                    {
                        answer += key.KeyChar;
                    }
                }

                Thread.Sleep(10);
            }

            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine("\nHACKING FAILED! SYSTEM SHUTDOWN...");
        }

        public void HandleInput(GameManager gameManager, string input)
        {
            Console.SetCursorPosition(0, 0);
            Console.WriteLine("\r\n\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$*!;;;;;*$##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=~             ~$#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=-                 -=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:                     :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                       -$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                         ~$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                           ~#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:                             !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*   ..                         -$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~   ~~                          !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=   ,=:                          :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;   ;=,                          .=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$,  -$!                            *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$   ;$~                            *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  -$*                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~#:                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~=.                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*     ,:-          .:~         *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*   .;$#$=,       =$##*-       *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*   ;@@@@@#.     $@@@@@*.  ~:  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$. ~*  :@@@@@@@:    .@@@@@@@!  ;;  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#: ~*  ;@@@@@@@*.   ~@@@@@@@*  ;; .=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@= ~* .*@@@@@@@-     @@@@@@@=. ;; :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$-~* ,*@@@@@@@,     @@@@@@@$- ;; !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=;! .*@@@@@@:      .@@@@@@#~ ;**@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:  ;@@@@@=.  :*   ,@@@@@*  ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~   ~#@@@-    #@    ,@@@=   ~#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=       .      ~@@               !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=              #@@,              !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$.             #@@#              *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.           ,#@@@            .!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$-.         !$!=$          .,!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=~,       ~            .,!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;.                 ,;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@!.               ~$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$=#@!.             -$@$$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@; :#@!,           -=#!-~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@=**#@@@@@@@@@@@@@@@;  !@@$:~~~~~~~~~:$@*  ~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@=!,  :$@@@@@@@@@@@@@@;  ~#@=!#*@*$*!@!@@#-  ~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@=,     -#@@@@@@@@@@@@@;   *@- $,#.~. @.@@$   ~@@@@@@@@@@@@@@@@!!!!*@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@#~       :@@@@@@@@@@@@@;   *@*;#!@;;;;@;@@$   :@@@@@@@@@@@@@@@;    .*@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@$:.        ;@@@@@@@@@@@@;   *@@@@@@@@@@@@@@*  .;@@@@@@@@@@@@@@;      .*@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@$:-           =@@@@@@@@@@@!   :#@@@@@@@@@@@@#,  ,=@@@@@@@@@@@@@*        -@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@$-             -@@@@@@@@@@@$-  .=@!#;#;:@#:@@$   -#@@@@@@@@@@@@#,        .*@@@@@@@@@@@@@@@@\r\n@@@@@@@@#:               ~#@@@@@@@@@@:   :#-$,#. @~ @#~   ~@@@@@@@@@@@@@~          .:=@@@@@@@@@@@@@@\r\n@@@@@@@@=.                ~$@@@@@@@@@=-  .~!@*@,*@**@~   ,=@@@@@@@@@@@@:             ,*@@@@@@@@@@@@@\r\n@@@@@@@@!                  ,;@@@@@@@@@;    -~~~.~~~~-    ;@@@@@@@@@@@=~               ,=@@@@@@@@@@@@\r\n@@@@@@@#:       ;,           :@@@@@@@@#~                ,#@@@@@@@@@@;,                 ;@@@@@@@@@@@@\r\n@@@@@@@@!       *$*.          -;@@@@@@@#-              ,$@@@@@@@@@$:                   ,*@@@@@@@@@@@\r\n@@@@@@@@*       .,-*$*          -!@@@@@@#-            .$@@@@@@@@@;,            -        !@@@@@@@@@@@\r\n@@@@@@@@@*,        .,,!=         .-*@@@@@#-          .$@@@@@@@@;,             ;=        ;@@@@@@@@@@@\r\n@@@@@@@@@@#$;.        ..           .-=@@@@##$$$$$$####@@@@@@#:.           :$$:,.       ~#@@@@@@@@@@@\r\n@@@@@@@@@@@@@####=,                  .:#@@@@@@@@@@@@@@@@@@$-.          ~$;...         ,=@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@##:                  !@@@@@@@@@@@@@@@$,                          -=@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@#:                 =@@@@@@@@@@@$.                      ;##@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@#.               .$@@@@@@@#.                   ,#@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@!               -#@@@@.                  =@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.              ;@@                .*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=-              ##.           .!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$:.            .#=.      .:#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$:.            -$!. .-*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=~.            ;=!#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#$~ ;!-.           ,=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=:    .!*~.           -=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=*~        ~*!~            ~=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=*!.            !#:~            ~=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@$******=====*****;.              -~$@@~-           .:*$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@$;,      .....                   -:$@@@@@#~,            -!*=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@$~                             .~;#@@@@@@@@@=:,             .:!!!!!!!**$#@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@!    -~.                     ,:*#@@@@@@@@@@@@@=:.                     .-:!!*#@@@@@@@@@@@@@@@\r\n@@@@@@@#;    -~.                   ,;*@@@@@@@@@@@@@@@@@@*:.                        .:=@@@@@@@@@@@@@@\r\n@@@@@@@@!                        ~;=@@@@@@@@@@@@@@@@@@@@@#*:.    -~                  :@@@@@@@@@@@@@@\r\n@@@@@@@@=.                     :!$@@@@@@@@@@@@@@@@@@@@@@@@@#*!~  --:.          .:-   ~#@@@@@@@@@@@@@\r\n@@@@@@@@#*-      ~.          -*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$!,  -:,          ~,   ~#@@@@@@@@@@@@@\r\n@@@@@@@@@@$*-    *-         *$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=-  -~-              ~@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@$-   *=!*,    -*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$~  .~;            ,*@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@;   ,;;~.   !$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;. .-!          ~=@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@#~   ..   -=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*.  -!==;   ,==#@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@#-     ,=$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.  ,--,  .$@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@#=;~!=$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$.      .=@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*    .$@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##=##@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n");
            Console.ReadLine();
        }
    }
}
