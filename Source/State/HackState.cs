using System.ComponentModel.Design;
using System.Data;
using System.Drawing;
using System.Text;

namespace _15TextRPG.Source.State
{
    internal class HackState(Action<string> HackingProcess) : IGameState
    {
        string[] commandList = 
        { 
            "search",
            "item",
            "hack"
        };
        string command = "";
        List<string> commands = new List<string>();
        int commandIndex = -1;

        public void DisplayMenu(GameManager gameManager)
        {
            Console.OutputEncoding = Encoding.UTF8;
            Console.BackgroundColor = ConsoleColor.Black;
            Console.ForegroundColor = ConsoleColor.Green;
            Console.Title = "Hacking in Progress...";
            Console.Clear();

            int totalTime = 1000; // 해킹 제한 시간 (초)
            int barLength = 3000; // 진행 바 길이

            int cursorTop, cursorLeft;

            Console.WriteLine("Hacking in progress...");
            Console.WriteLine("Time Remaining:");

            Console.SetCursorPosition(0, 2);
            Console.WriteLine("ss");
            Console.WriteLine($" {30} sec remaining");
            Console.WriteLine("==========================================");
            Console.Write(">> ");

            for (int timeLeft = totalTime; timeLeft >= 0; timeLeft--)
            {
                cursorTop = Console.CursorTop;
                cursorLeft = Console.CursorLeft;
                Console.SetCursorPosition(0, 0);
                Console.WriteLine("Hacking in progress...                                ");
                Console.SetCursorPosition(0, 1);
                Console.WriteLine("Time Remaining:                                       ");
                int filled = (int)((timeLeft / (float)totalTime) * barLength);
                string progressBar = "[" + new string('█', filled/100) + new string(' ', (barLength - filled)/100) + "                   ";

                Console.SetCursorPosition(0, 2);
                Console.WriteLine(progressBar);
                Console.WriteLine($" {timeLeft}                                                    ");
                Console.WriteLine("==========================================");
                Console.SetCursorPosition(cursorLeft, cursorTop);


                ConsoleKeyInfo key;
                if (Console.KeyAvailable)
                {
                    key = Console.ReadKey();

                    if (key.Key == ConsoleKey.Enter)
                    {
                        HackingProcess(command);
                        commands.Add(command);
                        Console.WriteLine();
                        command = "";
                        commandIndex = -1;
                        Console.Write(">> ");
                        Console.Beep();
                    }
                    else if (key.Key == ConsoleKey.Backspace)
                    {
                        if (command.Length > 0)
                        {
                            command = command.Substring(0, command.Length - 1);

                            Console.SetCursorPosition(Console.CursorLeft, Console.CursorTop);
                            Console.Write(" ");
                            Console.SetCursorPosition(Console.CursorLeft - 1, Console.CursorTop);
                        }
                    }
                    else if (key.Key == ConsoleKey.UpArrow)
                    {
                        if (commands.Count > 0)
                        {
                            if(commands.Count - 1 > commandIndex)
                            {
                                ++commandIndex;
                            }
                            command = commands[commands.Count - 1 - commandIndex];
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(new string(' ', Console.WindowWidth));
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(">> ");
                            Console.Write(command);
                        }
                    }
                    else if (key.Key == ConsoleKey.UpArrow)
                    {
                        if (commands.Count > 0)
                        {
                            if (commands.Count - 1 > commandIndex)
                            {
                                ++commandIndex;
                            }
                            command = commands[commands.Count - 1 - commandIndex];
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(new string(' ', Console.WindowWidth));
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(">> ");
                            Console.Write(command);
                        }
                    }
                    else if (key.Key == ConsoleKey.DownArrow)
                    {
                        if (commands.Count > 0)
                        {
                            if (commandIndex > 0)
                            {
                                --commandIndex;
                            }
                            command = commands[commands.Count - 1 - commandIndex];
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(new string(' ', Console.WindowWidth));
                            Console.SetCursorPosition(0, Console.CursorTop);
                            Console.Write(">> ");
                            Console.Write(command);
                        }
                    }
                    else
                    {
                        command += key.KeyChar;
                    }
                }

                Thread.Sleep(1);
            }

            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine("\nHACKING FAILED! SYSTEM SHUTDOWN...");
        }


        public void HandleInput(GameManager gameManager)
        {
            Console.SetCursorPosition(0, 0);
            Console.WriteLine("\r\n\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@###$*!;;;;;*$##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=~             ~$#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=-                 -=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:                     :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                       -$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                         ~$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~                           ~#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:                             !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*   ..                         -$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~   ~~                          !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=   ,=:                          :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;   ;=,                          .=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$,  -$!                            *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$   ;$~                            *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  -$*                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~#:                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~=.                             *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*     ,:-          .:~         *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*   .;$#$=,       =$##*-       *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$  ~*   ;@@@@@#.     $@@@@@*.  ~:  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$. ~*  :@@@@@@@:    .@@@@@@@!  ;;  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#: ~*  ;@@@@@@@*.   ~@@@@@@@*  ;; .=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@= ~* .*@@@@@@@-     @@@@@@@=. ;; :#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$-~* ,*@@@@@@@,     @@@@@@@$- ;; !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=;! .*@@@@@@:      .@@@@@@#~ ;**@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:  ;@@@@@=.  :*   ,@@@@@*  ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#~   ~#@@@-    #@    ,@@@=   ~#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=       .      ~@@               !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=              #@@,              !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$.             #@@#              *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.           ,#@@@            .!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$-.         !$!=$          .,!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=~,       ~            .,!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;.                 ,;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@!.               ~$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$=#@!.             -$@$$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@; :#@!,           -=#!-~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@=**#@@@@@@@@@@@@@@@;  !@@$:~~~~~~~~~:$@*  ~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@=!,  :$@@@@@@@@@@@@@@;  ~#@=!#*@*$*!@!@@#-  ~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@=,     -#@@@@@@@@@@@@@;   *@- $,#.~. @.@@$   ~@@@@@@@@@@@@@@@@!!!!*@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@#~       :@@@@@@@@@@@@@;   *@*;#!@;;;;@;@@$   :@@@@@@@@@@@@@@@;    .*@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@$:.        ;@@@@@@@@@@@@;   *@@@@@@@@@@@@@@*  .;@@@@@@@@@@@@@@;      .*@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@$:-           =@@@@@@@@@@@!   :#@@@@@@@@@@@@#,  ,=@@@@@@@@@@@@@*        -@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@$-             -@@@@@@@@@@@$-  .=@!#;#;:@#:@@$   -#@@@@@@@@@@@@#,        .*@@@@@@@@@@@@@@@@\r\n@@@@@@@@#:               ~#@@@@@@@@@@:   :#-$,#. @~ @#~   ~@@@@@@@@@@@@@~          .:=@@@@@@@@@@@@@@\r\n@@@@@@@@=.                ~$@@@@@@@@@=-  .~!@*@,*@**@~   ,=@@@@@@@@@@@@:             ,*@@@@@@@@@@@@@\r\n@@@@@@@@!                  ,;@@@@@@@@@;    -~~~.~~~~-    ;@@@@@@@@@@@=~               ,=@@@@@@@@@@@@\r\n@@@@@@@#:       ;,           :@@@@@@@@#~                ,#@@@@@@@@@@;,                 ;@@@@@@@@@@@@\r\n@@@@@@@@!       *$*.          -;@@@@@@@#-              ,$@@@@@@@@@$:                   ,*@@@@@@@@@@@\r\n@@@@@@@@*       .,-*$*          -!@@@@@@#-            .$@@@@@@@@@;,            -        !@@@@@@@@@@@\r\n@@@@@@@@@*,        .,,!=         .-*@@@@@#-          .$@@@@@@@@;,             ;=        ;@@@@@@@@@@@\r\n@@@@@@@@@@#$;.        ..           .-=@@@@##$$$$$$####@@@@@@#:.           :$$:,.       ~#@@@@@@@@@@@\r\n@@@@@@@@@@@@@####=,                  .:#@@@@@@@@@@@@@@@@@@$-.          ~$;...         ,=@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@##:                  !@@@@@@@@@@@@@@@$,                          -=@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@#:                 =@@@@@@@@@@@$.                      ;##@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@#.               .$@@@@@@@#.                   ,#@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@!               -#@@@@.                  =@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.              ;@@                .*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=-              ##.           .!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$:.            .#=.      .:#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$:.            -$!. .-*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=~.            ;=!#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#$~ ;!-.           ,=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=:    .!*~.           -=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=*~        ~*!~            ~=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=*!.            !#:~            ~=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@$******=====*****;.              -~$@@~-           .:*$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@$;,      .....                   -:$@@@@@#~,            -!*=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@$~                             .~;#@@@@@@@@@=:,             .:!!!!!!!**$#@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@!    -~.                     ,:*#@@@@@@@@@@@@@=:.                     .-:!!*#@@@@@@@@@@@@@@@\r\n@@@@@@@#;    -~.                   ,;*@@@@@@@@@@@@@@@@@@*:.                        .:=@@@@@@@@@@@@@@\r\n@@@@@@@@!                        ~;=@@@@@@@@@@@@@@@@@@@@@#*:.    -~                  :@@@@@@@@@@@@@@\r\n@@@@@@@@=.                     :!$@@@@@@@@@@@@@@@@@@@@@@@@@#*!~  --:.          .:-   ~#@@@@@@@@@@@@@\r\n@@@@@@@@#*-      ~.          -*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$!,  -:,          ~,   ~#@@@@@@@@@@@@@\r\n@@@@@@@@@@$*-    *-         *$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=-  -~-              ~@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@$-   *=!*,    -*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$~  .~;            ,*@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@;   ,;;~.   !$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#;. .-!          ~=@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@#~   ..   -=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*.  -!==;   ,==#@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@#-     ,=$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.  ,--,  .$@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@#=;~!=$@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@$.      .=@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*    .$@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##=##@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n");

            Console.ForegroundColor = ConsoleColor.White;
            Console.BackgroundColor = ConsoleColor.Black;
            Console.ReadLine();
        }
    }
}
